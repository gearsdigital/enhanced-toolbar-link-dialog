(()=>{(function(){"use strict";var g=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("k-dialog",{ref:"dialog",staticClass:"k-pages-dialog",attrs:{size:"medium",button:t.$t("insert")},on:{submit:t.submit,open:t.fetch,close:t.resetForm}},[e("div",{staticClass:"k-header"},[t.tabs&&t.tabs.length>1?e("div",{staticClass:"k-tabs"},[e("nav",t._l(t.tabs,function(a){return e("k-button",{staticClass:"k-tab-button",attrs:{current:t.currentTab&&t.currentTab.name===a.name},on:{click:function(r){return t.selectTab(a)}}},[t._v(" "+t._s(a.label)+" ")])}),1)]):t._e()]),t.currentTab.name==="external"?e("div",{staticClass:"k-tab"},[e("k-form",{ref:"form",attrs:{fields:t.externalFields},on:{submit:t.submit},model:{value:t.value,callback:function(a){t.value=a},expression:"value"}})],1):t._e(),t.currentTab.name==="internal"?e("div",{staticClass:"k-tab"},[e("k-input",{staticClass:"k-dialog-search",attrs:{autofocus:"true",placeholder:t.$t("search")+" \u2026",type:"text",icon:"search"},model:{value:t.search,callback:function(a){t.search=a},expression:"search"}}),t.hasPages?e("div",[e("k-items",{attrs:{layout:"list"}},t._l(t.pages,function(a){return e("k-item",{key:a.id,attrs:{text:a.title,layout:"list"},on:{click:function(r){return t.selectPage(a)}}},[e("template",{slot:"options"},[t.isCurrentPage(a)?e("k-button",{attrs:{slot:"options",autofocus:"true",icon:"check",theme:"positive",tooltip:t.$t("remove")},slot:"options"}):e("k-button",{attrs:{slot:"options",autofocus:"true",icon:"circle-outline",tooltip:t.$t("select")},slot:"options"})],1)],2)}),1),e("k-pagination",t._b({staticClass:"k-dialog-pagination",attrs:{details:!0,dropdown:!1,align:"center"},on:{paginate:t.paginate}},"k-pagination",t.pagination,!1)),e("k-line-field"),e("k-form",{attrs:{fields:t.attributeFields},model:{value:t.attributes,callback:function(a){t.attributes=a},expression:"attributes"}})],1):e("k-text",[t._v(" "+t._s(t.$t("gearsdigital.enhanced-toolbar-link-dialog.empty"))+" ")])],1):t._e()])},p=[],T="";function b(t,i,e,a,r,u,h,$){var n=typeof t=="function"?t.options:t;i&&(n.render=i,n.staticRenderFns=e,n._compiled=!0),a&&(n.functional=!0),u&&(n._scopeId="data-v-"+u);var s;if(h?(s=function(l){l=l||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!l&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(l=__VUE_SSR_CONTEXT__),r&&r.call(this,l),l&&l._registeredComponents&&l._registeredComponents.add(h)},n._ssrRegister=s):r&&(s=$?function(){r.call(this,(n.functional?this.parent:this).$root.$options.shadowRoot)}:r),s)if(n.functional){n._injectStyles=s;var m=n.render;n.render=function(x,d){return s.call(d),m(x,d)}}else{var c=n.beforeCreate;n.beforeCreate=c?[].concat(c,s):[s]}return{exports:t,options:n}}const f={data(){return{tabs:[{name:"external",label:this.$t("gearsdigital.enhanced-toolbar-link-dialog.external")},{name:"internal",label:this.$t("gearsdigital.enhanced-toolbar-link-dialog.internal")}],search:null,currentPage:{},currentTab:{},pages:[],value:{url:null,text:null},pagination:{page:1,total:0},externalFields:{url:{label:this.$t("link"),type:"text",placeholder:this.$t("url.placeholder"),icon:"url"},text:{label:this.$t("link.text"),type:"text"}},attributeFields:{selectedLinkTarget:{label:this.$t("gearsdigital.enhanced-toolbar-link-dialog.target.title"),type:"select",width:"1/2",options:[{value:"_blank",text:"Blank"},{value:"_self",text:"Self"},{value:"_parent",text:"Parent"},{value:"_top",text:"Top"}],help:this.$t("gearsdigital.enhanced-toolbar-link-dialog.target.help")},title:{width:"1/2",label:this.$t("gearsdigital.enhanced-toolbar-link-dialog.title.title"),type:"text"},anchor:{width:"1/2",label:this.$t("gearsdigital.enhanced-toolbar-link-dialog.anchor.title"),type:"text"}},attributes:{selectedLinkTarget:null,title:null,anchor:null}}},watch:{search:function(t,i){t!==i&&(this.pagination.page=0,this.fetch())}},computed:{hasPages(){return console.log(this.pages),this.pages.length},kirbytext(){return this.$config.kirbytext},urlWithAnchor(){return this.attributes.anchor?this.value.url+"#"+this.attributes.anchor:this.value.url}},methods:{open(t,i){const e=parseInt(this.$t("gearsdigital.enhanced-toolbar-link-dialog.tab.order"),10)||0;this.value.text=i,this.currentTab=this.tabs[e],this.$refs.dialog.open()},resetForm(){this.value={url:null,text:null},this.value.text=null,this.search=null,this.pagination.page=1,this.attributes={selectedLinkTarget:null,title:null,anchor:null}},selectTab(t){this.currentTab=t},selectPage(t){this.value={url:t.slug,text:this.value.text||t.title},this.isCurrentPage(t)?(this.currentPage={},this.value={url:null,text:null}):this.currentPage=t},isCurrentPage(t){return this.currentPage===t},paginate(t){this.pagination.page=t.page,this.fetch()},createKirbytext(){const t=[];return t.push(`link: ${this.urlWithAnchor}`),t.push(`text: ${this.value.text}`),this.attributes.selectedLinkTarget&&t.push(`target: ${this.attributes.selectedLinkTarget}`),this.attributes.title&&t.push(`title: ${this.attributes.title}`),this.value.url.indexOf("http")===0&&t.push("rel: nofollow"),`(${t.join(" ")})`},createMarkdown(){return this.value.text.length>0?`[${this.value.text}](${this.value.url})`:`<${this.value.url}>`},fetch(){const t={page:this.pagination.page,search:this.search};this.$api.get("enhanced-toolbar-link-dialog/pages",t).then(i=>{this.pages=i.data,this.pagination=i.pagination})},submit(){if(this.value.url===null){this.$refs.dialog.close();return}this.$emit("submit",this.kirbytext?this.createKirbytext():this.createMarkdown()),this.$refs.dialog.close()}}},o={};var v=b(f,g,p,!1,k,"0166450c",null,null);function k(t){for(let i in o)this[i]=o[i]}var _=function(){return v.exports}();panel.plugin("gearsdigital/enhanced-toolbar-link-dialog",{components:{"k-toolbar-link-dialog":{extends:_}}})})();})();
