(function(){"use strict";function o(t,e,i,n,a,h,d,S){var l=typeof t=="function"?t.options:t;e&&(l.render=e,l.staticRenderFns=i,l._compiled=!0),n&&(l.functional=!0),h&&(l._scopeId="data-v-"+h);var s;if(d?(s=function(r){r=r||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!r&&typeof __VUE_SSR_CONTEXT__<"u"&&(r=__VUE_SSR_CONTEXT__),a&&a.call(this,r),r&&r._registeredComponents&&r._registeredComponents.add(d)},l._ssrRegister=s):a&&(s=S?function(){a.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:a),s)if(l.functional){l._injectStyles=s;var R=l.render;l.render=function(D,u){return s.call(u),R(D,u)}}else{var c=l.beforeCreate;l.beforeCreate=c?[].concat(c,s):[s]}return{exports:t,options:l}}const g={data(){return{link:{href:null,title:null,target:!1,text:null,anchor:null}}},computed:{fields(){return{href:{label:this.$t("link"),type:"autosuggest",id:this.link.href},text:{label:this.$t("link.text"),type:"text",icon:"title"},title:{label:this.$t("title"),type:"text",counter:!1,icon:"title"},anchor:{label:this.$t("gearsdigital.enhanced-toolbar-link-dialog.anchor.title"),type:"text",counter:!1,before:"#",width:"1/2"},target:{label:this.$t("open.newWindow"),type:"toggle",text:[this.$t("no"),this.$t("yes")],width:"1/2"}}},kirbytext(){return this.$config.kirbytext}},methods:{open(t,e){this.link.text=e,this.$refs.dialog.open(),this.addListener()},close(){this.$emit("cancel"),this.removeListener(),this.link={href:null,title:null,target:!1,text:null,anchor:null}},submit(){this.$emit("submit",this.kirbytext?this.createKirbytext():this.createMarkdown()),this.link={href:null,title:null,target:!1,text:null,anchor:null},this.$refs.dialog.close()},createKirbytext(){const t=[];return t.push(`link: ${this.appendAnchor(this.link.href)}`),this.link.text&&this.link.text.length>0&&t.push(`text: ${this.link.text}`),this.link.title&&this.link.title.length>0&&t.push(`title: ${this.link.title}`),this.link.target&&t.push("target: _blank"),`(${t.join(" ")})`},createMarkdown(){return this.link.text.length>0?`[${this.link.text}](${this.link.href})`:`<${this.link.href}>`},appendAnchor(t){let e=this.$refs.dialog.model.anchor;return e?(t||(t=""),e.startsWith("#")?t+e:t+"#"+e):t},listener(t){t.detail.page!==null&&(this.link={...this.link,href:t.detail.page.link,title:t.detail.page.text})},addListener(){document.addEventListener("enhanced-toolbar-link-dialog/page",this.listener)},removeListener(){document.removeEventListener("enhanced-toolbar-link-dialog/page",this.listener)}}};var f=function(){var e=this,i=e._self._c;return i("k-form-dialog",{ref:"dialog",attrs:{fields:e.fields,"submit-button":e.$t("confirm"),size:"medium"},on:{close:e.close,submit:e.submit},model:{value:e.link,callback:function(n){e.link=n},expression:"link"}})},p=[],m=o(g,f,p,!1,null,null,null,null);const _=m.exports,F="",k={data(){return{link:{href:null,title:null,target:!1,anchor:null}}},computed:{fields(){return{href:{label:this.$t("link"),type:"autosuggest",id:this.link.href},title:{label:this.$t("title"),type:"text",counter:!1,icon:"title"},anchor:{label:this.$t("gearsdigital.enhanced-toolbar-link-dialog.anchor.title"),type:"text",counter:!1,before:"#",width:"1/2"},target:{label:this.$t("open.newWindow"),type:"toggle",text:[this.$t("no"),this.$t("yes")],width:"1/2"}}}},methods:{open(t){this.link={title:null,target:!1,anchor:null,...this.extendWithAnchor(t)},this.link.target=Boolean(this.link.target),this.$refs.dialog.open(),this.addListener()},close(){this.$emit("close"),this.removeListener()},submit(){this.link.href=this.appendAnchor(this.link.href),this.$emit("submit",{...this.link,target:this.link.target?"_blank":null}),this.$refs.dialog.close()},extendWithAnchor(t){var i,n;if(!t.href)return t;const e=t.href.split("#");return{...t,href:(i=e[0])!=null?i:null,anchor:(n=e[1])!=null?n:null}},appendAnchor(t){let e=this.$refs.dialog.model.anchor;return e?(t||(t=""),e.startsWith("#")?t+e:t+"#"+e):t},listener(t){t.detail.page===null?this.link={href:null,title:null,target:!1}:this.link={...this.link,href:t.detail.page.link,title:t.detail.page.text}},addListener(){document.addEventListener("enhanced-toolbar-link-dialog/page",this.listener)},removeListener(){document.removeEventListener("enhanced-toolbar-link-dialog/page",this.listener)}}};var b=function(){var e=this,i=e._self._c;return i("k-form-dialog",{ref:"dialog",attrs:{fields:e.fields,"submit-button":e.$t("confirm"),size:"medium"},on:{close:e.close,submit:e.submit},model:{value:e.link,callback:function(n){e.link=n},expression:"link"}})},$=[],v=o(k,b,$,!1,null,null,null,null);const x=v.exports,N="",y={name:"EnhancedToolbarDropdown",props:{pages:{type:Array},pagination:{type:{page:Number,total:Number,limit:Number}}},data(){return{open:!0,currentItem:0}},watch:{pages(){this.focusCurrentItem()}},mounted(){this.focusCurrentItem(),window.addEventListener("keydown",this.keydownListener)},destroyed(){window.removeEventListener("keydown",this.keydownListener)},methods:{select(t){this.$emit("select",t),this.open=!1,this.currentItem=0},focusCurrentItem(){document.querySelector(`.enhanced-toolbar-dialog-element div[data-index="${this.currentItem}"]`).focus()},blurCurrentItem(){document.querySelector(`.enhanced-toolbar-dialog-element div[data-index="${this.currentItem}"]`).blur()},keydownListener(t){var a;const e=this.currentItem<this.pages.length-1,i=this.currentItem>0,n=t.code;n==="ArrowDown"&&e&&(this.blurCurrentItem(),this.currentItem++,this.focusCurrentItem()),n==="ArrowUp"&&i&&(this.blurCurrentItem(),this.currentItem--,this.focusCurrentItem()),n==="Tab"&&(this.currentItem=(a=parseInt(document.activeElement.getAttribute("data-index"),10))!=null?a:0),n==="Enter"&&(t.stopPropagation(),t.preventDefault(),this.select(this.pages[this.currentItem]))}}};var w=function(){var e=this,i=e._self._c;return i("dialog",{staticClass:"enhanced-toolbar-dialog-element",attrs:{open:e.open}},[e._l(e.pages,function(n,a){return i("div",{key:n.id,attrs:{"data-index":a,tabindex:0}},[i("k-item",{attrs:{text:n.text,image:n.image,info:n.id},on:{click:function(h){return e.select(n)}}})],1)}),i("k-pagination",{attrs:{align:"center",details:!0,page:e.pagination.page,total:e.pagination.total,limit:e.pagination.limit},on:{paginate:function(n){return e.$emit("paginate",n)}}})],2)},E=[],T=o(y,w,E,!1,null,"b8f6aa9f",null,null);const C=T.exports,U="",L={name:"EnhancedToolbarAutosuggest",components:{EnhancedToolbarDropdown:C},props:{id:String,label:String},data(){return{searchTerm:"",pagination:{},pages:[],selectedPage:[],url:""}},watch:{selectedPage(t){t.length||document.dispatchEvent(new CustomEvent("enhanced-toolbar-link-dialog/page",{detail:{page:null}}))}},async created(){this.updateSearch=this.$helper.debounce(this.updateSearch,200),this.id&&await this.$api.get("enhanced-toolbar-link-dialog/page",{id:this.id}).then(t=>{this.selectedPage=[t]}).catch(t=>{t.code===404&&(this.url=this.id)})},methods:{async fetch(t,e){const i=(e==null?void 0:e.page)||1;if(!this.searchTerm){this.pages=[];return}if(this.searchTerm.startsWith("http")||this.searchTerm.startsWith("/")){this.pages=[];return}const n=await this.$api.get("enhanced-toolbar-link-dialog/pages",{q:this.searchTerm,page:i});this.pages=n.data,this.pagination=n.pagination},updateSearch(t){this.searchTerm=t,this.fetch(),this.$emit("input",t)},selectPage(t){document.dispatchEvent(new CustomEvent("enhanced-toolbar-link-dialog/page",{detail:{page:t}})),this.selectedPage=[t],this.url=""}}};var I=function(){var e=this,i=e._self._c;return i("div",{staticClass:"enhanced-toolbar-autosuggest-field"},[e.selectedPage.length===0?i("k-text-field",{attrs:{counter:!1,icon:"file-document",label:e.label,placeholder:e.$t("gearsdigital.enhanced-toolbar-link-dialog.autosuggest.placeholder"),name:"autosuggesttext"},on:{input:e.updateSearch},model:{value:e.url,callback:function(n){e.url=n},expression:"url"}}):e._e(),e.selectedPage.length===1?i("k-tags-field",{attrs:{counter:!1,icon:"file-document",label:e.label,name:"tags",type:"tags",max:"1"},model:{value:e.selectedPage,callback:function(n){e.selectedPage=n},expression:"selectedPage"}}):e._e(),e.pages.length?i("enhanced-toolbar-dropdown",{attrs:{pages:e.pages,pagination:e.pagination},on:{select:e.selectPage,paginate:function(n){return e.fetch(e.searchTerm,n)}}}):e._e()],1)},A=[],P=o(L,I,A,!1,null,"f1fbdecd",null,null);const W=P.exports;panel.plugin("gearsdigital/enhanced-toolbar-link-dialog",{components:{"k-toolbar-link-dialog":{extends:_},"k-writer":{extends:"k-writer",components:{"k-writer-link-dialog":x}}},fields:{autosuggest:W}})})();
